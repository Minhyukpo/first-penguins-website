<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>íšŒì›ê°€ì… - First-Penguins</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ë¡œê³  ìŠ¤íƒ€ì¼ */
        .logo-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0f2fe;
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .logo-icon:hover {
            background: #bae6fd;
        }

        .penguin-icon {
            width: 35px;
            height: 35px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            transition: all 0.3s ease;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            white-space: nowrap;
            min-width: 0;
        }

        .logo-main {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.2;
        }
        
        .logo-sub {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 400;
        }

        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background: #f8f9fa;
            padding: 40px 20px;
        }
        
        .auth-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 600px;
            text-align: left;
            border: 1px solid #e9ecef;
        }
        
        .auth-logo {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auth-logo h2 {
            color: #1e293b;
            font-size: 1.8rem;
            margin: 0;
            font-weight: 600;
        }
        
        .auth-logo p {
            color: #64748b;
            font-size: 0.95rem;
            margin: 8px 0 0 0;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .form-help {
            display: block;
            margin-top: 6px;
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            box-sizing: border-box;
            background: #ffffff;
            color: #1e293b;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-group input.error {
            border-color: #e74c3c;
        }
        
        .form-group input.success {
            border-color: #27ae60;
        }
        
        .password-strength {
            margin-top: 5px;
            font-size: 0.8rem;
        }
        
        .strength-weak { color: #e74c3c; }
        .strength-medium { color: #f39c12; }
        .strength-strong { color: #27ae60; }
        
        .auth-btn,
        .step-btn.btn-next,
        .step-btn.btn-prev {
            width: 100%;
            padding: 12px 24px;
            background: #1e293b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 20px;
        }
        
        .auth-btn:hover,
        .step-btn.btn-next:hover {
            background: #334155;
        }
        
        .step-btn.btn-prev {
            background: #ffffff;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }
        
        .step-btn.btn-prev:hover {
            background: #f8f9fa;
            border-color: #cbd5e1;
        }
        
        .auth-btn:disabled,
        .step-btn.btn-next:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        
        .auth-divider {
            margin: 30px 0;
            position: relative;
            text-align: center;
        }
        
        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e9ecef;
        }
        
        .auth-divider span {
            background: white;
            padding: 0 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .social-login {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .social-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #2c3e50;
        }
        
        .social-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .auth-links {
            text-align: center;
        }
        
        .auth-links a {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 0 10px;
        }
        
        .auth-links a:hover {
            text-decoration: underline;
        }
        
        .back-home {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #64748b;
            text-decoration: none;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .back-home:hover {
            color: #1e293b;
        }
        
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.875rem;
            display: none;
            border: 1px solid #fecaca;
        }
        
        .success-message {
            background: #f0fdf4;
            color: #16a34a;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.875rem;
            display: none;
            border: 1px solid #bbf7d0;
        }
        
        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .terms-checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .terms-checkbox label {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
        }
        
        .terms-checkbox a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .terms-checkbox a:hover {
            text-decoration: underline;
        }
        
        .required {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .form-section-divider {
            margin: 30px 0 20px;
            position: relative;
            text-align: center;
        }
        
        .form-section-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e9ecef;
        }
        
        .form-section-divider span {
            background: white;
            padding: 0 15px;
            color: #7f8c8d;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .age-display {
            margin-top: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #495057;
        }
        
        .age-display strong {
            color: #667eea;
            font-weight: 600;
        }
        
        /* ë‹¨ê³„ë³„ íšŒì›ê°€ì… ìŠ¤íƒ€ì¼ */
        .registration-steps {
            margin-bottom: 30px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e9ecef;
            z-index: 0;
        }
        
        .step-item {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step-item.active .step-number {
            background: #3b82f6;
            color: white;
        }
        
        .step-item.completed .step-number {
            background: #10b981;
            color: white;
        }
        
        .step-item.completed .step-number::after {
            content: 'âœ“';
            font-size: 1.2rem;
        }
        
        .step-label {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 400;
        }
        
        .step-item.active .step-label {
            color: #1e293b;
            font-weight: 500;
        }
        
        .step-content {
            display: none !important;
        }
        
        .step-content.active {
            display: block !important;
        }
        
        .step-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .step-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-next:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-prev {
            background: #f8f9fa;
            color: #2c3e50;
            border: 2px solid #e9ecef;
        }
        
        .btn-prev:hover {
            background: #e9ecef;
        }
        
        .verification-code-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .verification-code-input input {
            flex: 1;
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 0.2rem;
            font-weight: 600;
        }
        
        .verification-timer {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .verification-timer.warning {
            color: #e74c3c;
        }
        
        .id-check-result {
            margin-top: 8px;
            font-size: 0.9rem;
            padding: 8px;
            border-radius: 6px;
        }
        
        .id-check-result.available {
            background: #d4edda;
            color: #155724;
        }
        
        .id-check-result.unavailable {
            background: #f8d7da;
            color: #721c24;
        }
        
        .id-check-result.checking {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .guardian-agreement-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .guardian-agreement-section h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .guardian-agreement-section p {
            color: #856404;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .btn-consent {
            background: #1e293b;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 16px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .btn-consent:hover {
            background: #334155;
        }
        
        .btn-consent:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }
        
        select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        @media (max-width: 480px) {
            .auth-card {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .social-login {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-home">
        <i class="fas fa-arrow-left"></i>
        í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </a>
    
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="logo-icon">
                    <img src="../images/company-photos/firstpenguins-profile.jpg" alt="First-Penguins Logo" class="penguin-logo" style="width: 32px; height: 32px; object-fit: contain;">
                </div>
                <div style="flex: 1;">
                    <div class="logo-text">
                        <span class="logo-main">First-Penguins</span>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h1 style="font-size: 1.75rem; font-weight: 600; color: #1e293b; margin: 0 0 8px 0;">íšŒì›ê°€ì…</h1>
                <p style="font-size: 0.95rem; color: #64748b; margin: 0;">ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <!-- ë‹¨ê³„ë³„ ì§„í–‰ í‘œì‹œ -->
            <div class="registration-steps">
                <div class="step-indicator">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">ì´ë©”ì¼ ì¸ì¦</div>
                    </div>
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">ì•„ì´ë”” í™•ì¸</div>
                    </div>
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">ìƒë…„ì›”ì¼</div>
                    </div>
                    <div class="step-item" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">ë¹„ë°€ë²ˆí˜¸</div>
                    </div>
                    <div class="step-item" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-label">ë™ì˜</div>
                    </div>
                </div>
            </div>
            
            <form id="registerForm">
                <!-- Step 1: ì´ë©”ì¼ ì…ë ¥ ë° ì¸ì¦ -->
                <div class="step-content active" id="step1">
                    <div class="form-group">
                        <label for="email">ì´ë©”ì¼ ì£¼ì†Œ <span class="required">*</span></label>
                        <div style="display: flex; gap: 10px;">
                            <input type="email" id="email" name="email" placeholder="example@gmail.com" required style="flex: 1;">
                            <button type="button" id="sendVerificationBtn" class="btn-consent btn-accept-selected" style="min-width: 100px; padding: 12px;">
                                ì¸ì¦ë²ˆí˜¸ ë°œì†¡
                            </button>
                        </div>
                        <small class="form-help">ì´ë©”ì¼ë¡œ ì¸ì¦ë²ˆí˜¸ë¥¼ ë°œì†¡í•©ë‹ˆë‹¤</small>
                    </div>
                    
                    <div class="form-group" id="verificationCodeGroup" style="display: none;">
                        <label for="verificationCode">ì¸ì¦ë²ˆí˜¸ <span class="required">*</span></label>
                        <div class="verification-code-input">
                            <input type="text" id="verificationCode" name="verificationCode" maxlength="6" placeholder="000000" required>
                            <button type="button" id="verifyCodeBtn" class="btn-consent btn-accept-selected" style="min-width: 80px;">
                                í™•ì¸
                            </button>
                        </div>
                        <div class="verification-timer" id="verificationTimer" style="display: none;"></div>
                        <small class="form-help" id="verificationHelp">ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</small>
                        <div style="margin-top: 10px; text-align: center;">
                            <button type="button" id="resendCodeBtn" class="btn-consent" style="background: transparent; color: #3b82f6; border: 1px solid #3b82f6; padding: 8px 16px; font-size: 0.875rem; display: none;">
                                ì¸ì¦ë²ˆí˜¸ ì¬ë°œì†¡
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: ì•„ì´ë”” ì…ë ¥ ë° ì¤‘ë³µ í™•ì¸ -->
                <div class="step-content" id="step2">
                    <div class="form-group">
                        <label for="userId">ì•„ì´ë”” <span class="required">*</span></label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="userId" name="userId" placeholder="ì˜ë¬¸, ìˆ«ì 4-20ì" required pattern="[a-zA-Z0-9]{4,20}" style="flex: 1;">
                            <button type="button" id="checkIdBtn" class="btn-consent btn-accept-selected" style="min-width: 100px; padding: 12px;">
                                ì¤‘ë³µ í™•ì¸
                            </button>
                        </div>
                        <div id="idCheckResult" class="id-check-result" style="display: none;"></div>
                        <small class="form-help">ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥ (4-20ì)</small>
                    </div>
                </div>
                
                <!-- Step 3: ìƒë…„ì›”ì¼ ì…ë ¥ -->
                <div class="step-content" id="step3">
                    <div class="form-group">
                        <label for="birthDate">ìƒë…„ì›”ì¼ <span class="required">*</span></label>
                        <input type="date" id="birthDate" name="birthDate" max="" required>
                        <small class="form-help">ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ë©´ ë‚˜ì´ê°€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤</small>
                        <div id="ageDisplay" class="age-display" style="display: none;"></div>
                    </div>
                </div>
                
                <!-- Step 4: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
                <div class="step-content" id="step4">
                    <div class="form-group">
                        <label for="password">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                        <input type="password" id="password" name="password" required placeholder="8ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”">
                        <div class="password-strength" id="passwordStrength"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span></label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
                
                <!-- Step 5: ë™ì˜ ë° ë³´í˜¸ì ë™ì˜ -->
                <div class="step-content" id="step5">
                    <div class="form-group">
                        <label for="name">ì´ë¦„ <span class="required">*</span></label>
                        <input type="text" id="name" name="name" required placeholder="í™ê¸¸ë™">
                    </div>
                    
                    <div class="terms-checkbox">
                        <input type="checkbox" id="terms" name="terms" required>
                        <label for="terms">
                            <a href="../support/terms-of-service.html" target="_blank">ì´ìš©ì•½ê´€</a> ë° 
                            <a href="../support/privacy-policy.html" target="_blank">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)
                        </label>
                    </div>
                    
                    <!-- 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë³´í˜¸ì ë™ì˜ -->
                    <div id="guardianAgreementSection" class="guardian-agreement-section" style="display: none;">
                        <h4>âš ï¸ ë³´í˜¸ì ë™ì˜ í•„ìš”</h4>
                        <p>ë§Œ 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë³´í˜¸ì ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <div class="terms-checkbox">
                            <input type="checkbox" id="guardianAgreement" name="guardianAgreement">
                            <label for="guardianAgreement">
                                ë³´í˜¸ì ë™ì˜ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. (í•„ìˆ˜)
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ë²„íŠ¼ ì˜ì—­ -->
                <div class="step-buttons">
                    <button type="button" id="prevBtn" class="step-btn btn-prev" style="display: none;">
                        <i class="fas fa-arrow-left"></i> ì´ì „
                    </button>
                    <button type="button" id="nextBtn" class="step-btn btn-next">
                        ë‹¤ìŒ <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="submit" id="submitBtn" class="step-btn btn-next" style="display: none;">
                        <i class="fas fa-user-plus"></i> íšŒì›ê°€ì… ì™„ë£Œ
                    </button>
                </div>
            </form>
            
            <div class="auth-divider">
                <span>ë˜ëŠ”</span>
            </div>
            
            <div class="social-login">
                <button class="social-btn" onclick="registerWithGoogle()">
                    <i class="fab fa-google"></i>
                    Google
                </button>
                <button class="social-btn" onclick="registerWithApple()">
                    <i class="fab fa-apple"></i>
                    Apple
                </button>
            </div>
            
            <div class="auth-links">
                <a href="login.html">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
            </div>
        </div>
    </div>
    
    <script>
        // ë‹¨ê³„ë³„ íšŒì›ê°€ì… ê´€ë¦¬
        let currentStep = 1;
        const totalSteps = 5;
        let registrationData = {
            email: '',
            emailVerified: false,
            userId: '',
            userIdChecked: false,
            birthDate: '',
            age: null,
            password: '',
            name: '',
            termsAgreed: false,
            guardianAgreement: null
        };
        
        // ë‹¨ê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStep(step) {
            currentStep = step;
            
            // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.step-item').forEach((item, index) => {
                const stepNum = index + 1;
                item.classList.remove('active', 'completed');
                if (stepNum < step) {
                    item.classList.add('completed');
                } else if (stepNum === step) {
                    item.classList.add('active');
                }
            });
            
            // ì½˜í…ì¸  í‘œì‹œ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.step-content').forEach((content, index) => {
                content.classList.remove('active');
                if (index + 1 === step) {
                    content.classList.add('active');
                }
            });
            
            // ë²„íŠ¼ í‘œì‹œ ì—…ë°ì´íŠ¸
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.style.display = step > 1 ? 'block' : 'none';
            nextBtn.style.display = step < totalSteps ? 'block' : 'none';
            submitBtn.style.display = step === totalSteps ? 'block' : 'none';
        }
        
        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
        function goToNextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    updateStep(currentStep + 1);
                }
            }
        }
        
        // ì´ì „ ë‹¨ê³„ë¡œ ì´ë™
        function goToPrevStep() {
            if (currentStep > 1) {
                updateStep(currentStep - 1);
            }
        }
        
        // í˜„ì¬ ë‹¨ê³„ ê²€ì¦
        function validateCurrentStep() {
            switch(currentStep) {
                case 1: // ì´ë©”ì¼ ì¸ì¦
                    if (!registrationData.emailVerified) {
                        showError('ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                    
                case 2: // ì•„ì´ë”” í™•ì¸
                    const userId = document.getElementById('userId').value.trim();
                    if (!userId) {
                        showError('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    if (!/^[a-zA-Z0-9]{4,20}$/.test(userId)) {
                        showError('ì•„ì´ë””ëŠ” ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©° 4-20ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                        return false;
                    }
                    if (!registrationData.userIdChecked) {
                        showError('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                    
                case 3: // ìƒë…„ì›”ì¼
                    const birthDate = document.getElementById('birthDate').value;
                    if (!birthDate) {
                        showError('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                    
                case 4: // ë¹„ë°€ë²ˆí˜¸
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    if (!password || !confirmPassword) {
                        showError('ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    if (password.length < 8) {
                        showError('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                        return false;
                    }
                    if (password !== confirmPassword) {
                        showError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return false;
                    }
                    return true;
                    
                case 5: // ë™ì˜
                    const name = document.getElementById('name').value.trim();
                    const terms = document.getElementById('terms').checked;
                    if (!name) {
                        showError('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    if (!terms) {
                        showError('ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    // 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë³´í˜¸ì ë™ì˜ í™•ì¸
                    if (registrationData.age && registrationData.age < 14) {
                        const guardianAgreement = document.getElementById('guardianAgreement').checked;
                        if (!guardianAgreement) {
                            showError('14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë³´í˜¸ì ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                            return false;
                        }
                    }
                    return true;
                    
                default:
                    return false;
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('nextBtn').addEventListener('click', goToNextStep);
        document.getElementById('prevBtn').addEventListener('click', goToPrevStep);
        
        // Step 1: ì´ë©”ì¼ ì¸ì¦
        let verificationTimer = null;
        let verificationCodeSent = false;
        
        document.getElementById('sendVerificationBtn').addEventListener('click', async function() {
            const email = document.getElementById('email').value.trim();
            if (!email) {
                showError('ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
            try {
                if (window.supabase) {
                    const { data, error } = await window.supabase
                        .from('users')
                        .select('email')
                        .eq('email', email)
                        .single();
                    
                    if (data) {
                        showError('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                        return;
                    }
                }
            } catch (e) {
                // ì¤‘ë³µì´ ì•„ë‹Œ ê²½ìš° ê³„ì† ì§„í–‰
            }
            
            // ì¸ì¦ë²ˆí˜¸ ë°œì†¡
            this.disabled = true;
            this.textContent = 'ë°œì†¡ ì¤‘...';
            
            try {
                // ì¸ì¦ë²ˆí˜¸ ìƒì„±
                const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Supabase Edge Function í˜¸ì¶œí•˜ì—¬ ì´ë©”ì¼ ë°œì†¡
                if (window.supabase && window.CONFIG?.supabase?.url) {
                    const supabaseUrl = window.CONFIG.supabase.url;
                    const functionUrl = `${supabaseUrl}/functions/v1/send-verification-email`;
                    
                    // Supabase Auth í† í° ê°€ì ¸ì˜¤ê¸°
                    const { data: { session } } = await window.supabase.auth.getSession();
                    const token = session?.access_token || '';
                    
                    const response = await fetch(functionUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': window.CONFIG.supabase.anonKey || '',
                            'Authorization': `Bearer ${window.CONFIG.supabase.anonKey || ''}`
                        },
                        body: JSON.stringify({
                            email: email,
                            code: verificationCode
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.error || 'ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì‹¤íŒ¨');
                    }
                    
                    // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì¸ì¦ë²ˆí˜¸ë¥¼ í™”ë©´ì— í‘œì‹œ
                    if (result.code) {
                        console.log('ğŸ” ì¸ì¦ë²ˆí˜¸ (ê°œë°œìš©):', result.code);
                        document.getElementById('verificationHelp').textContent = `ê°œë°œ í™˜ê²½: ì¸ì¦ë²ˆí˜¸ëŠ” ${result.code} ì…ë‹ˆë‹¤`;
                    }
                    
                    // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ë°±ì—…ìš©)
                    sessionStorage.setItem('verificationCode', verificationCode);
                    sessionStorage.setItem('verificationEmail', email);
                    sessionStorage.setItem('verificationExpires', Date.now() + 300000); // 5ë¶„
                    
                    registrationData.email = email;
                    document.getElementById('verificationCodeGroup').style.display = 'block';
                    verificationCodeSent = true;
                    
                    // íƒ€ì´ë¨¸ ì‹œì‘
                    startVerificationTimer();
                    
                    showSuccess('ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    this.textContent = 'ì¬ë°œì†¡';
                    this.disabled = false;
                    
                    // ì¬ë°œì†¡ ë²„íŠ¼ í‘œì‹œ
                    const resendBtn = document.getElementById('resendCodeBtn');
                    if (resendBtn) {
                        resendBtn.style.display = 'inline-block';
                    }
                } else {
                    // Supabaseê°€ ì—†ìœ¼ë©´ ë¡œì»¬ ê°œë°œ ëª¨ë“œ
                    console.log('ğŸ” ì¸ì¦ë²ˆí˜¸ (ë¡œì»¬ ê°œë°œ):', verificationCode);
                    sessionStorage.setItem('verificationCode', verificationCode);
                    sessionStorage.setItem('verificationEmail', email);
                    sessionStorage.setItem('verificationExpires', Date.now() + 300000);
                    
                    registrationData.email = email;
                    document.getElementById('verificationCodeGroup').style.display = 'block';
                    document.getElementById('verificationHelp').textContent = `ë¡œì»¬ ê°œë°œ: ì¸ì¦ë²ˆí˜¸ëŠ” ${verificationCode} ì…ë‹ˆë‹¤`;
                    verificationCodeSent = true;
                    
                    startVerificationTimer();
                    
                    showSuccess('ì¸ì¦ë²ˆí˜¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ê°œë°œ ëª¨ë“œ)');
                    this.textContent = 'ì¬ë°œì†¡';
                    this.disabled = false;
                    
                    // ì¬ë°œì†¡ ë²„íŠ¼ í‘œì‹œ
                    const resendBtn = document.getElementById('resendCodeBtn');
                    if (resendBtn) {
                        resendBtn.style.display = 'inline-block';
                    }
                }
                
            } catch (error) {
                console.error('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì˜¤ë¥˜:', error);
                showError('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                this.disabled = false;
                this.textContent = 'ì¸ì¦ë²ˆí˜¸ ë°œì†¡';
            }
        });
        
        // ì¬ë°œì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('resendCodeBtn').addEventListener('click', function() {
            // ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ë²„íŠ¼ í´ë¦­ê³¼ ë™ì¼í•œ ë™ì‘
            document.getElementById('sendVerificationBtn').click();
        });
        
        // ì¸ì¦ë²ˆí˜¸ í™•ì¸
        document.getElementById('verifyCodeBtn').addEventListener('click', function() {
            const inputCode = document.getElementById('verificationCode').value.trim();
            const storedCode = sessionStorage.getItem('verificationCode');
            const expires = parseInt(sessionStorage.getItem('verificationExpires'));
            
            if (!inputCode) {
                showError('ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (Date.now() > expires) {
                showError('ì¸ì¦ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë°œì†¡í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (inputCode === storedCode) {
                registrationData.emailVerified = true;
                document.getElementById('verificationCodeGroup').style.display = 'none';
                document.getElementById('verificationTimer').style.display = 'none';
                document.getElementById('resendCodeBtn').style.display = 'none';
                document.getElementById('email').disabled = true;
                showSuccess('ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                clearInterval(verificationTimer);
            } else {
                showError('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        });
        
        // ì¸ì¦ë²ˆí˜¸ íƒ€ì´ë¨¸
        function startVerificationTimer() {
            const timerElement = document.getElementById('verificationTimer');
            let timeLeft = 300; // 5ë¶„
            
            timerElement.style.display = 'block';
            
            verificationTimer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `ë‚¨ì€ ì‹œê°„: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 60) {
                    timerElement.classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(verificationTimer);
                    timerElement.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    timerElement.classList.add('warning');
                }
                
                timeLeft--;
            }, 1000);
        }
        
        // Step 2: ì•„ì´ë”” ì¤‘ë³µ í™•ì¸
        document.getElementById('checkIdBtn').addEventListener('click', async function() {
            const userId = document.getElementById('userId').value.trim();
            const resultDiv = document.getElementById('idCheckResult');
            
            if (!userId) {
                showError('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!/^[a-zA-Z0-9]{4,20}$/.test(userId)) {
                showError('ì•„ì´ë””ëŠ” ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©° 4-20ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            this.disabled = true;
            this.textContent = 'í™•ì¸ ì¤‘...';
            resultDiv.style.display = 'block';
            resultDiv.className = 'id-check-result checking';
            resultDiv.textContent = 'í™•ì¸ ì¤‘...';
            
            try {
                // Supabaseì—ì„œ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸
                if (window.supabase) {
                    const { data, error } = await window.supabase
                        .from('users')
                        .select('id')
                        .eq('id', userId)
                        .single();
                    
                    if (data) {
                        resultDiv.className = 'id-check-result unavailable';
                        resultDiv.textContent = 'âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                        registrationData.userIdChecked = false;
                    } else {
                        resultDiv.className = 'id-check-result available';
                        resultDiv.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                        registrationData.userId = userId;
                        registrationData.userIdChecked = true;
                    }
                } else {
                    // ë ˆê±°ì‹œ API ì‚¬ìš©
                    const response = await fetch(window.CONFIG.api.baseUrl + window.CONFIG.api.endpoints.checkId + '?id=' + userId);
                    const result = await response.json();
                    
                    if (result.available) {
                        resultDiv.className = 'id-check-result available';
                        resultDiv.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                        registrationData.userId = userId;
                        registrationData.userIdChecked = true;
                    } else {
                        resultDiv.className = 'id-check-result unavailable';
                        resultDiv.textContent = 'âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                        registrationData.userIdChecked = false;
                    }
                }
            } catch (error) {
                resultDiv.className = 'id-check-result unavailable';
                resultDiv.textContent = 'âŒ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                registrationData.userIdChecked = false;
            }
            
            this.disabled = false;
            this.textContent = 'ì¤‘ë³µ í™•ì¸';
        });
        
        // Step 3: ìƒë…„ì›”ì¼ ì…ë ¥ ì‹œ ë‚˜ì´ ê³„ì‚°
        document.getElementById('birthDate').addEventListener('change', function() {
            const birthDate = this.value;
            const ageDisplay = document.getElementById('ageDisplay');
            
            if (birthDate) {
                const today = new Date();
                const birth = new Date(birthDate);
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                
                if (age >= 0 && age <= 120) {
                    registrationData.age = age;
                    registrationData.birthDate = birthDate;
                    ageDisplay.innerHTML = `ë§Œ <strong>${age}ì„¸</strong>ì…ë‹ˆë‹¤`;
                    ageDisplay.style.display = 'block';
                    
                    // 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë³´í˜¸ì ë™ì˜ ì„¹ì…˜ í‘œì‹œ
                    if (age < 14) {
                        document.getElementById('guardianAgreementSection').style.display = 'block';
                        document.getElementById('guardianAgreement').required = true;
                    } else {
                        document.getElementById('guardianAgreementSection').style.display = 'none';
                        document.getElementById('guardianAgreement').required = false;
                    }
                } else {
                    ageDisplay.innerHTML = 'ì˜¬ë°”ë¥¸ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                    ageDisplay.style.display = 'block';
                }
            } else {
                ageDisplay.style.display = 'none';
            }
        });
        
        // ìƒë…„ì›”ì¼ ìµœëŒ€ê°’ ì„¤ì •
        document.getElementById('birthDate').max = new Date().toISOString().split('T')[0];
        
        // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì²´í¬
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const strengthDiv = document.getElementById('passwordStrength');
            
            if (password.length === 0) {
                strengthDiv.textContent = '';
                this.classList.remove('error', 'success');
                return;
            }
            
            let strength = 0;
            let strengthText = '';
            
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            if (strength < 3) {
                strengthText = 'ì•½í•¨';
                strengthDiv.className = 'password-strength strength-weak';
                this.classList.add('error');
                this.classList.remove('success');
            } else if (strength < 5) {
                strengthText = 'ë³´í†µ';
                strengthDiv.className = 'password-strength strength-medium';
                this.classList.remove('error', 'success');
            } else {
                strengthText = 'ê°•í•¨';
                strengthDiv.className = 'password-strength strength-strong';
                this.classList.add('success');
                this.classList.remove('error');
            }
            
            strengthDiv.textContent = `ë¹„ë°€ë²ˆí˜¸ ê°•ë„: ${strengthText}`;
        });
        
        // ìƒë…„ì›”ì¼ì—ì„œ ë‚˜ì´ ìë™ ê³„ì‚°
        document.getElementById('birthDate').addEventListener('change', function() {
            const birthDate = this.value;
            const ageDisplay = document.getElementById('ageDisplay');
            
            if (birthDate) {
                const today = new Date();
                const birth = new Date(birthDate);
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                
                if (age >= 0 && age <= 120) {
                    ageDisplay.innerHTML = `ë§Œ <strong>${age}ì„¸</strong>ì…ë‹ˆë‹¤`;
                    ageDisplay.style.display = 'block';
                    // ìˆ¨ê²¨ì§„ age í•„ë“œì— ê°’ ì €ì¥ (í•„ìš”ì‹œ)
                    document.getElementById('age').value = age;
                } else {
                    ageDisplay.innerHTML = 'ì˜¬ë°”ë¥¸ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                    ageDisplay.style.display = 'block';
                }
            } else {
                ageDisplay.style.display = 'none';
            }
        });
        
        // ìƒë…„ì›”ì¼ ìµœëŒ€ê°’ ì„¤ì • (ì˜¤ëŠ˜ ë‚ ì§œ)
        document.getElementById('birthDate').max = new Date().toISOString().split('T')[0];
        
        // ìˆ¨ê²¨ì§„ age í•„ë“œ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ì„±)
        const ageInput = document.createElement('input');
        ageInput.type = 'hidden';
        ageInput.id = 'age';
        ageInput.name = 'age';
        document.getElementById('registerForm').appendChild(ageInput);
        
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì²´í¬
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            
            if (confirmPassword.length === 0) {
                this.classList.remove('error', 'success');
                return;
            }
            
            if (password === confirmPassword) {
                this.classList.add('success');
                this.classList.remove('error');
            } else {
                this.classList.add('error');
                this.classList.remove('success');
            }
        });
        
        // íšŒì›ê°€ì… í¼ ì²˜ë¦¬ (ë‹¨ê³„ë³„ ë°ì´í„° ìˆ˜ì§‘)
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // ë§ˆì§€ë§‰ ë‹¨ê³„ ê²€ì¦
            if (!validateCurrentStep()) {
                return;
            }
            
            // ëª¨ë“  ë‹¨ê³„ ë°ì´í„° ìˆ˜ì§‘
            registrationData.name = document.getElementById('name').value.trim();
            registrationData.password = document.getElementById('password').value;
            registrationData.termsAgreed = document.getElementById('terms').checked;
            
            const guardianAgreementEl = document.getElementById('guardianAgreement');
            if (guardianAgreementEl) {
                registrationData.guardianAgreement = registrationData.age < 14 ? guardianAgreementEl.checked : null;
            }
            
            // Goal-Illa users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆì— ë§ì¶˜ ë°ì´í„°
            const userData = {
                // í•„ìˆ˜ í•„ë“œ
                id: registrationData.userId, // ì•„ì´ë”” ì‚¬ìš©
                email: registrationData.email, // ì´ë©”ì¼
                name: registrationData.name,
                password: registrationData.password, // í•´ì‹œí™”ëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬
                
                // ì„ íƒ í•„ë“œ (users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜)
                age: registrationData.age,
                birth_date: registrationData.birthDate,
                guardian_agreement: registrationData.guardianAgreement,
                
                // ìë™ ì„¤ì • í•„ë“œ
                is_active: true,
                email_verified: true, // ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            // íšŒì›ê°€ì… ì²˜ë¦¬
            registerUser(registrationData.name, registrationData.email, registrationData.password, userData);
        });
        
        async function registerUser(name, email, password, userData = {}) {
            try {
                // Supabase ë˜ëŠ” Goal-Illa APIë¡œ íšŒì›ê°€ì… ì‹œë„
                if (window.CompanyWebsiteAPI && window.CONFIG?.supabase?.enabled !== false) {
                    // Supabase Auth ì‚¬ìš©
                    const registerData = {
                        email: email,
                        password: password,
                        name: name,
                        id: email, // Goal-IllaëŠ” idë¡œ ì‚¬ìš©
                        ...userData
                    };
                    
                    const data = await window.CompanyWebsiteAPI.register(registerData);
                    
                    if (data.success) {
                        // Supabaseì— ì‚¬ìš©ì ì •ë³´ ì¶”ê°€ ì €ì¥ (users í…Œì´ë¸”)
                        if (window.supabase) {
                            try {
                                // Goal-Illa users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆì— ë§ì¶° ì €ì¥
                                const { error: dbError } = await window.supabase
                                    .from('users')
                                    .insert([{
                                        id: userData.id, // ì•„ì´ë””
                                        email: userData.email, // ì´ë©”ì¼
                                        name: userData.name,
                                        password: userData.password, // ì‹¤ì œë¡œëŠ” í•´ì‹œí™” í•„ìš”
                                        age: userData.age,
                                        birth_date: userData.birth_date,
                                        guardian_agreement: userData.guardian_agreement,
                                        is_active: userData.is_active,
                                        email_verified: userData.email_verified, // ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ
                                        created_at: userData.created_at,
                                        updated_at: userData.updated_at
                                    }]);
                                
                                if (dbError) {
                                    console.warn('ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', dbError);
                                    // ì—ëŸ¬ê°€ ìˆì–´ë„ íšŒì›ê°€ì…ì€ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ (AuthëŠ” ì´ë¯¸ ì™„ë£Œë¨)
                                } else {
                                    console.log('âœ… ì‚¬ìš©ì ì •ë³´ê°€ Goal-Illa users í…Œì´ë¸”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                }
                            } catch (dbError) {
                                console.warn('ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', dbError);
                            }
                        }
                        
                        showSuccess('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                        
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        showError(data.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // ë ˆê±°ì‹œ API ì‚¬ìš©
                    const response = await fetch(window.CONFIG.api.baseUrl + '/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            // Goal-Illa users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆì— ë§ì¶˜ ë°ì´í„°
                            id: userData.id, // ì•„ì´ë””
                            email: userData.email,
                            name: userData.name,
                            password: userData.password,
                            age: userData.age,
                            birth_date: userData.birth_date,
                            guardian_agreement: userData.guardian_agreement,
                            is_active: userData.is_active,
                            email_verified: userData.email_verified
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                        
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        showError(data.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                showError('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }
        
        function registerWithGoogle() {
            showError('Google íšŒì›ê°€ì…ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        }
        
        function registerWithApple() {
            showError('Apple íšŒì›ê°€ì…ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        }
        
        function showTerms() {
            alert('ì´ìš©ì•½ê´€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.');
        }
        
        function showPrivacy() {
            alert('ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.');
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            successDiv.style.display = 'none';
        }
        
        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            errorDiv.style.display = 'none';
        }
        
        // DOM ë¡œë“œ í›„ ì´ˆê¸°í™”
        function initRegistration() {
            // ì²« ë²ˆì§¸ ë‹¨ê³„ë¡œ ì„¤ì •
            updateStep(1);
            
            // ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì í™•ì¸
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                window.location.href = '../index.html';
                return;
            }
        }
        
        // DOMì´ ì¤€ë¹„ë˜ë©´ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initRegistration);
        } else {
            initRegistration();
        }
    </script>
    
    <!-- Analytics & Monitoring -->
    <script src="../js/config.js"></script>
    <script src="../js/analytics.js"></script>
    
    <!-- Supabase ë° API ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-client.js"></script>
    <script src="../js/company-website-api.js"></script>
</body>
</html>

